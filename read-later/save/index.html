<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Saving... | Jeff Harris</title>
  <meta name="description" content="Saving a link to the read-later list.">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600&family=Inter:wght@400;500&display=swap" rel="stylesheet">

  <link rel="icon" href="/favicon.ico">
  <style>
    :root {
      --bg: #F6F3EF;
      --bg-card: #FFFFFF;
      --text: #1C1A18;
      --text-muted: #6F6A66;
      --accent: #C9861D;
      --accent-strong: #B67615;
      --border: rgba(0, 0, 0, 0.08);
      --shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
      --font-display: 'Sora', system-ui, sans-serif;
      --font-body: 'Inter', system-ui, sans-serif;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #141210;
        --bg-card: #1F1D1B;
        --text: #F4F1ED;
        --text-muted: #A19A93;
        --accent: #E5A341;
        --accent-strong: #F1B75D;
        --border: rgba(255, 255, 255, 0.1);
        --shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
      }
    }

    *, *::before, *::after { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; min-height: 100%; }

    body {
      font-family: var(--font-body);
      background: var(--bg);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      -webkit-font-smoothing: antialiased;
    }

    .bg-gradient {
      position: fixed;
      inset: 0;
      z-index: -2;
      background:
        radial-gradient(ellipse 60% 45% at 15% 20%, rgba(201, 134, 29, 0.1), transparent),
        radial-gradient(ellipse 55% 50% at 85% 15%, rgba(89, 112, 176, 0.08), transparent),
        radial-gradient(ellipse 50% 40% at 45% 80%, rgba(36, 140, 120, 0.06), transparent);
    }

    .bg-noise {
      position: fixed;
      inset: 0;
      z-index: -1;
      opacity: 0.35;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      pointer-events: none;
    }

    .card {
      width: min(480px, 100%);
      background: var(--bg-card);
      border-radius: 20px;
      padding: 32px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }

    .back-link {
      font-size: 13px;
      color: var(--text-muted);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    h1 {
      font-family: var(--font-display);
      font-size: 28px;
      margin: 16px 0 8px;
    }

    p {
      margin: 0 0 20px;
      color: var(--text-muted);
    }

    .actions {
      display: grid;
      gap: 10px;
      margin-top: 16px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 10px 14px;
      border-radius: 999px;
      text-decoration: none;
      font-size: 13px;
      border: 1px solid var(--border);
      transition: all 200ms ease;
    }

    .btn.primary {
      background: var(--accent);
      color: #fff;
      border-color: transparent;
    }

    .btn.primary:hover {
      background: var(--accent-strong);
    }

    .btn.secondary {
      color: var(--text);
      background: transparent;
    }
  </style>
</head>
<body>
  <div class="bg-gradient"></div>
  <div class="bg-noise"></div>

  <main class="card">
    <a class="back-link" href="/read-later">‚Üê Back to read later</a>
    <h1 id="headline">Saving link...</h1>
    <p id="message">Hang tight while we add this to the list.</p>

    <div class="actions" id="actions">
      <a class="btn primary" id="open-link" href="#" target="_blank" rel="noopener">Open saved link</a>
      <a class="btn secondary" href="/read-later">View read-later list</a>
    </div>
  </main>

  <script>
    (() => {
      const params = new URLSearchParams(window.location.search);
      const rawUrl = params.get('url') || params.get('u');
      const rawTitle = params.get('title') || params.get('t') || '';
      const headline = document.getElementById('headline');
      const message = document.getElementById('message');
      const openLink = document.getElementById('open-link');
      const actions = document.getElementById('actions');

      if (!rawUrl) {
        headline.textContent = 'Missing link';
        message.textContent = 'We need a URL to save. Try sharing again.';
        actions.style.display = 'none';
        return;
      }

      openLink.href = rawUrl;

      fetch('/api/read-later', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url: rawUrl, title: rawTitle })
      })
        .then(response => response.json().then(data => ({ ok: response.ok, data })))
        .then(({ ok, data }) => {
          if (!ok || !data.ok) {
            throw new Error('Save failed');
          }
          headline.textContent = 'Saved!';
          message.textContent = 'This link is now in the read-later list.';
        })
        .catch(() => {
          headline.textContent = 'Something went wrong';
          message.textContent = 'We could not save that link right now.';
        });
    })();
  </script>
</body>
</html>
